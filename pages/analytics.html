{{define "content"}}
<div class="space-y-6" x-data="{
    activeTab: (localStorage.getItem('analyticsActiveTab') === 'daily' ? 'timeseries' : localStorage.getItem('analyticsActiveTab')) || 'general',
    chartFilter: 'both',
    timeInterval: 'daily',
    chart: null,
    netWorthChart: null,
    dailyData: {{.DailyReturnsJSON}} || [],
    netWorthData: {{.NetWorthDataJSON}} || [],
    init() {
        this.$watch('activeTab', value => {
            localStorage.setItem('analyticsActiveTab', value);
        });
        // Initialize chart if returning to timeseries or networth tab
        this.$nextTick(() => {
            if (this.activeTab === 'timeseries') {
                this.initChart();
            } else if (this.activeTab === 'networth') {
                this.initNetWorthChart();
            }
        });
    },
    getAggregatedData() {
        if (this.timeInterval === 'daily') {
            return this.dailyData;
        }

        if (this.timeInterval === 'weekly') {
            // Aggregate by week
            const weeklyData = {};
            this.dailyData.forEach(d => {
                const [year, month, day] = d.date.split('-');
                const date = new Date(year, month - 1, day);
                // Get Monday of the week
                const dayOfWeek = date.getDay();
                const diff = date.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
                const monday = new Date(date.setDate(diff));
                const weekKey = monday.toISOString().split('T')[0];

                if (!weeklyData[weekKey]) {
                    weeklyData[weekKey] = {
                        date: weekKey,
                        premiums: 0,
                        stockGains: 0,
                        totalReturns: 0,
                        premiumDetails: [],
                        stockDetails: []
                    };
                }

                weeklyData[weekKey].premiums += d.premiums;
                weeklyData[weekKey].stockGains += d.stockGains;
                weeklyData[weekKey].totalReturns += d.totalReturns;
                // Combine detail arrays
                if (d.premiumDetails) {
                    weeklyData[weekKey].premiumDetails = weeklyData[weekKey].premiumDetails.concat(d.premiumDetails);
                }
                if (d.stockDetails) {
                    weeklyData[weekKey].stockDetails = weeklyData[weekKey].stockDetails.concat(d.stockDetails);
                }
            });

            return Object.values(weeklyData).sort((a, b) => a.date.localeCompare(b.date));
        }

        // Aggregate by month
        const monthlyData = {};
        this.dailyData.forEach(d => {
            const [year, month, day] = d.date.split('-');
            const monthKey = `${year}-${month}`;

            if (!monthlyData[monthKey]) {
                monthlyData[monthKey] = {
                    date: `${year}-${month}-01`,
                    premiums: 0,
                    stockGains: 0,
                    totalReturns: 0,
                    premiumDetails: [],
                    stockDetails: []
                };
            }

            monthlyData[monthKey].premiums += d.premiums;
            monthlyData[monthKey].stockGains += d.stockGains;
            monthlyData[monthKey].totalReturns += d.totalReturns;
            // Combine detail arrays
            if (d.premiumDetails) {
                monthlyData[monthKey].premiumDetails = monthlyData[monthKey].premiumDetails.concat(d.premiumDetails);
            }
            if (d.stockDetails) {
                monthlyData[monthKey].stockDetails = monthlyData[monthKey].stockDetails.concat(d.stockDetails);
            }
        });

        return Object.values(monthlyData).sort((a, b) => a.date.localeCompare(b.date));
    },
    initChart() {
        if (!this.chart && this.dailyData.length > 0) {
            const ctx = document.getElementById('dailyReturnsChart').getContext('2d');

            const data = this.getAggregatedData();

            // Format labels based on time interval
            const labels = data.map(d => {
                const [year, month, day] = d.date.split('-');
                const date = new Date(year, month - 1, day);

                if (this.timeInterval === 'monthly') {
                    return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                } else {
                    const monthName = date.toLocaleDateString('en-US', { month: 'short' });
                    return monthName + ' ' + date.getDate();
                }
            });
            
            this.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Premiums',
                            data: data.map(d => d.premiums),
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: 'rgb(34, 197, 94)',
                            borderWidth: 1
                        },
                        {
                            label: 'Stock Gains',
                            data: data.map(d => d.stockGains),
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                },
                                afterBody: function(context) {
                                    const dataIndex = context[0].dataIndex;
                                    const rawData = data[dataIndex];
                                    const lines = [];

                                    // Show premium details if this is the premiums dataset or both
                                    if (rawData.premiumDetails && rawData.premiumDetails.length > 0) {
                                        lines.push('');
                                        lines.push('Premium Breakdown:');
                                        rawData.premiumDetails.forEach(d => {
                                            const formattedAmount = d.amount >= 0 ?
                                                '$' + d.amount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0}) :
                                                '-$' + Math.abs(d.amount).toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
                                            lines.push(`  ${d.symbol} ${d.type}: ${formattedAmount}`);
                                        });
                                    }

                                    // Show stock details if this is the stocks dataset or both
                                    if (rawData.stockDetails && rawData.stockDetails.length > 0) {
                                        lines.push('');
                                        lines.push('Stock Gains Breakdown:');
                                        rawData.stockDetails.forEach(d => {
                                            const formattedAmount = d.amount >= 0 ?
                                                '$' + d.amount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0}) :
                                                '-$' + Math.abs(d.amount).toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
                                            lines.push(`  ${d.symbol}: ${formattedAmount}`);
                                        });
                                    }

                                    return lines;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                },
                plugins: [{
                    id: 'totalLabel',
                    afterDatasetsDraw: function(chart) {
                        const ctx = chart.ctx;
                        chart.data.datasets[0].data.forEach(function(value, index) {
                            // Calculate total for this bar
                            let total = 0;
                            chart.data.datasets.forEach(function(dataset) {
                                total += dataset.data[index] || 0;
                            });

                            // Find the topmost bar to position the label
                            const lastDatasetIndex = chart.data.datasets.length - 1;
                            const meta = chart.getDatasetMeta(lastDatasetIndex);
                            const bar = meta.data[index];

                            ctx.fillStyle = 'black';
                            ctx.font = 'bold 12px sans-serif';
                            ctx.textAlign = 'center';
                            ctx.fillText('$' + total.toLocaleString(), bar.x, bar.y - 10);
                        });
                    }
                }]
            });
        }
    },
    updateChart() {
        if (!this.chart || this.dailyData.length === 0) return;

        const data = this.getAggregatedData();

        // Format labels based on time interval
        const labels = data.map(d => {
            const [year, month, day] = d.date.split('-');
            const date = new Date(year, month - 1, day);

            if (this.timeInterval === 'monthly') {
                return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            } else {
                const monthName = date.toLocaleDateString('en-US', { month: 'short' });
                return monthName + ' ' + date.getDate();
            }
        });

        // Destroy and recreate the chart to avoid update issues
        this.chart.destroy();
        const ctx = document.getElementById('dailyReturnsChart').getContext('2d');

        let datasets = [];
        if (this.chartFilter === 'premiums') {
            datasets = [{
                label: 'Premiums',
                data: data.map(d => d.premiums),
                backgroundColor: 'rgba(34, 197, 94, 0.8)',
                borderColor: 'rgb(34, 197, 94)',
                borderWidth: 1
            }];
        } else if (this.chartFilter === 'stocks') {
            datasets = [{
                label: 'Stock Gains',
                data: data.map(d => d.stockGains),
                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                borderColor: 'rgb(59, 130, 246)',
                borderWidth: 1
            }];
        } else {
            datasets = [
                {
                    label: 'Premiums',
                    data: data.map(d => d.premiums),
                    backgroundColor: 'rgba(34, 197, 94, 0.8)',
                    borderColor: 'rgb(34, 197, 94)',
                    borderWidth: 1
                },
                {
                    label: 'Stock Gains',
                    data: data.map(d => d.stockGains),
                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                    borderColor: 'rgb(59, 130, 246)',
                    borderWidth: 1
                }
            ];
        }
        
        this.chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: (this.chartFilter === 'both'),
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        stacked: (this.chartFilter === 'both'),
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                            },
                            afterBody: function(context) {
                                const dataIndex = context[0].dataIndex;
                                const rawData = data[dataIndex];
                                const lines = [];

                                // Show premium details if this is the premiums dataset or both
                                if (rawData.premiumDetails && rawData.premiumDetails.length > 0) {
                                    lines.push('');
                                    lines.push('Premium Breakdown:');
                                    rawData.premiumDetails.forEach(d => {
                                        const formattedAmount = d.amount >= 0 ?
                                            '$' + d.amount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0}) :
                                            '-$' + Math.abs(d.amount).toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
                                        lines.push(`  ${d.symbol} ${d.type}: ${formattedAmount}`);
                                    });
                                }

                                // Show stock details if this is the stocks dataset or both
                                if (rawData.stockDetails && rawData.stockDetails.length > 0) {
                                    lines.push('');
                                    lines.push('Stock Gains Breakdown:');
                                    rawData.stockDetails.forEach(d => {
                                        const formattedAmount = d.amount >= 0 ?
                                            '$' + d.amount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0}) :
                                            '-$' + Math.abs(d.amount).toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
                                        lines.push(`  ${d.symbol}: ${formattedAmount}`);
                                    });
                                }

                                return lines;
                            }
                        }
                    },
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            },
            plugins: [{
                id: 'totalLabel',
                afterDatasetsDraw: function(chart) {
                    const ctx = chart.ctx;
                    chart.data.datasets[0].data.forEach(function(value, index) {
                        // Calculate total for this bar
                        let total = 0;
                        chart.data.datasets.forEach(function(dataset) {
                            total += dataset.data[index] || 0;
                        });

                        // Find the topmost bar to position the label
                        const lastDatasetIndex = chart.data.datasets.length - 1;
                        const meta = chart.getDatasetMeta(lastDatasetIndex);
                        const bar = meta.data[index];

                        ctx.fillStyle = 'black';
                        ctx.font = 'bold 12px sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('$' + total.toLocaleString(), bar.x, bar.y - 5);
                    });
                }
            }]
        });
    },
    initNetWorthChart() {
        if (!this.netWorthChart && this.netWorthData.length > 0) {
            const ctx = document.getElementById('netWorthChart').getContext('2d');

            // Format labels (month names)
            const labels = this.netWorthData.map(d => {
                const [year, month] = d.month.split('-');
                const date = new Date(year, month - 1, 1);
                return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            });

            // Create stacked bar chart
            this.netWorthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Savings',
                            data: this.netWorthData.map(d => d.savingsBalance),
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: 'rgb(34, 197, 94)',
                            borderWidth: 1
                        },
                        {
                            label: 'Brokerage',
                            data: this.netWorthData.map(d => d.brokerageBalance),
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                },
                                footer: function(tooltipItems) {
                                    let total = 0;
                                    tooltipItems.forEach(function(tooltipItem) {
                                        total += tooltipItem.parsed.y;
                                    });
                                    return 'Total: $' + total.toLocaleString();
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        // Plugin to display total above bars
                        datalabels: false
                    }
                },
                plugins: [{
                    id: 'totalLabel',
                    afterDatasetsDraw: function(chart) {
                        const ctx = chart.ctx;
                        chart.data.datasets[0].data.forEach(function(value, index) {
                            const dataset1 = chart.data.datasets[0].data[index];
                            const dataset2 = chart.data.datasets[1].data[index];
                            const total = dataset1 + dataset2;

                            const meta = chart.getDatasetMeta(1);
                            const bar = meta.data[index];

                            ctx.fillStyle = 'black';
                            ctx.font = 'bold 12px sans-serif';
                            ctx.textAlign = 'center';
                            ctx.fillText('$' + total.toLocaleString(), bar.x, bar.y - 10);
                        });
                    }
                }]
            });
        }
    }
}">
    <h2 class="text-2xl font-bold text-gray-900">Analytics</h2>
    
    <!-- Tab Navigation -->
    <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <button @click="activeTab = 'general'"
                    :class="activeTab === 'general' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700'"
                    class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                General
            </button>
            <button @click="activeTab = 'timeseries'; $nextTick(() => initChart())"
                    :class="activeTab === 'timeseries' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700'"
                    class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                Time Series
            </button>
            <button @click="activeTab = 'networth'; $nextTick(() => initNetWorthChart())"
                    :class="activeTab === 'networth' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700'"
                    class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                Net Worth
            </button>
        </nav>
    </div>
    
    <!-- General Tab Content -->
    <div x-show="activeTab === 'general'" class="bg-white">
        <div class="mx-auto space-y-8 p-6">
            <!-- Portfolio Analytics Section -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Portfolio Analytics</h3>
                <div class="grid grid-cols-1 gap-px bg-gray-900/5 sm:grid-cols-2 lg:grid-cols-4">
                    <!-- Total Portfolio Value -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Total Portfolio Value</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalPortfolioValueFormatted}}</span>
                        </p>
                    </div>

                    <!-- Total Active Capital -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Total Active Capital</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalActiveCapitalFormatted}}</span>
                        </p>
                    </div>

                    <!-- Cumulative Capital Deployed -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Cumulative Capital Deployed</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalCapitalFormatted}}</span>
                        </p>
                    </div>

                    <!-- Total Deposits -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Total Deposits</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalDepositsFormatted}}</span>
                        </p>
                    </div>

                    <!-- IBKR Value -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8" x-data="{
                        portfolio: {{.TotalPortfolioValue}},
                        unrealized: {{.TotalUnrealizedPL}},
                        get ibkrValue() {
                            return this.portfolio + this.unrealized;
                        }
                    }">
                        <p class="text-sm/6 font-medium text-gray-500">IBKR Value</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">$<span x-text="ibkrValue.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0})"></span></span>
                        </p>
                    </div>

                    <!-- Total Net Worth -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Total Net Worth</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalNetWorthFormatted}}</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Returns Section -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Returns</h3>
                <div class="grid grid-cols-1 gap-px bg-gray-900/5 sm:grid-cols-2 lg:grid-cols-4">
                    <!-- Portfolio Return (Simple) -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Portfolio Return (Simple)</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalPortfolioProfitPercentageFormatted}}</span>
                        </p>
                    </div>

                    <!-- Time-Weighted Return -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Time-Weighted Return</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TimeWeightedReturnFormatted}}</span>
                        </p>
                    </div>

                    <!-- TWR Annualized -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">TWR Annualized (Target: 52%)</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TimeWeightedReturnAnnualizedFormatted}}</span>
                        </p>
                    </div>

                    <!-- Net Option Profit -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Net Option Profit</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalPremiumsFormatted}}</span>
                        </p>
                    </div>

                    <!-- Total Stock Profit -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Total Stock Profit</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalStockProfitFormatted}}</span>
                        </p>
                    </div>

                    <!-- Total Portfolio Profit -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Total Profit</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-green-600">{{.TotalPortfolioProfitFormatted}}</span>
                        </p>
                    </div>

                    <!-- Unrealized P&L -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8" x-data="{ unrealizedPL: {{.TotalUnrealizedPL}} }">
                        <p class="text-sm/6 font-medium text-gray-500">Unrealized P&L</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight" :class="unrealizedPL >= 0 ? 'text-green-600' : 'text-red-600'">{{.TotalUnrealizedPLFormatted}}</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Options Section -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Options</h3>
                <div class="grid grid-cols-1 gap-px bg-gray-900/5 sm:grid-cols-2 lg:grid-cols-4">
                    <!-- Premium Per Day -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Premium Per Day</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.PremiumPerDayFormatted}}</span>
                        </p>
                    </div>

                    <!-- Daily Theta -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Daily Theta</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.DailyThetaFormatted}}</span>
                        </p>
                    </div>

                    <!-- Average Return Per Trade -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Avg Return Per Option</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.AvgReturnPerTradeFormatted}}</span>
                        </p>
                    </div>

                    <!-- Number of Option Trades -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Number of Option Trades</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.OptionTradesCount}}</span>
                        </p>
                    </div>

                    <!-- Largest Premium -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Largest Premium</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.LargestPremiumFormatted}}</span>
                        </p>
                    </div>

                    <!-- Smallest Premium -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Smallest Premium</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.SmallestPremiumFormatted}}</span>
                        </p>
                    </div>

                    <!-- Average Premium -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Average Premium</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.AveragePremiumFormatted}}</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- General Section -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">General</h3>
                <div class="grid grid-cols-1 gap-px bg-gray-900/5 sm:grid-cols-2 lg:grid-cols-4">
                    <!-- Days Active -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Days Active</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.DaysSinceStart}}</span>
                        </p>
                    </div>

                    <!-- Number of Stock Trades -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Number of Stock Trades</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.StockTradesCount}}</span>
                        </p>
                    </div>

                    <!-- Total Number of Trades -->
                    <div class="bg-white px-4 py-6 sm:px-6 lg:px-8">
                        <p class="text-sm/6 font-medium text-gray-500">Total Number of Trades</p>
                        <p class="mt-2 flex items-baseline gap-x-2">
                            <span class="text-4xl font-semibold tracking-tight text-gray-900">{{.TotalTradesCount}}</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Time Series Tab Content -->
    <div x-show="activeTab === 'timeseries'" class="bg-white p-6">
        <!-- Filter Header with Daily/Weekly Toggle -->
        <div class="mb-4 flex justify-between items-center">
            <!-- Filter Buttons -->
            <div class="flex space-x-2">
            <button @click="chartFilter = 'both'; updateChart()" 
                    :class="chartFilter === 'both' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-700 border border-gray-300'"
                    class="px-4 py-2 rounded-md text-sm font-medium">
                Both
            </button>
            <button @click="chartFilter = 'premiums'; updateChart()" 
                    :class="chartFilter === 'premiums' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 border border-gray-300'"
                    class="px-4 py-2 rounded-md text-sm font-medium">
                Premiums Only
            </button>
            <button @click="chartFilter = 'stocks'; updateChart()"
                    :class="chartFilter === 'stocks' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 border border-gray-300'"
                    class="px-4 py-2 rounded-md text-sm font-medium">
                Stocks Only
            </button>
            </div>

            <!-- Daily/Weekly/Monthly Toggle -->
            <div class="flex space-x-2">
                <button @click="timeInterval = 'daily'; updateChart()"
                        :class="timeInterval === 'daily' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-700 border border-gray-300'"
                        class="px-4 py-2 rounded-md text-sm font-medium">
                    Daily
                </button>
                <button @click="timeInterval = 'weekly'; updateChart()"
                        :class="timeInterval === 'weekly' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-700 border border-gray-300'"
                        class="px-4 py-2 rounded-md text-sm font-medium">
                    Weekly
                </button>
                <button @click="timeInterval = 'monthly'; updateChart()"
                        :class="timeInterval === 'monthly' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-700 border border-gray-300'"
                        class="px-4 py-2 rounded-md text-sm font-medium">
                    Monthly
                </button>
            </div>
        </div>

        <!-- Chart Container -->
        <div class="relative h-96">
            <canvas id="dailyReturnsChart"></canvas>
        </div>
        
        <!-- No Data Message -->
        <div x-show="dailyData.length === 0" class="text-center text-gray-500 mt-8">
            No daily returns data available yet.
        </div>
    </div>

    <!-- Net Worth Tab Content -->
    <div x-show="activeTab === 'networth'" class="bg-white p-6">
        <!-- Chart Container -->
        <div class="relative h-96">
            <canvas id="netWorthChart"></canvas>
        </div>

        <!-- No Data Message -->
        <div x-show="netWorthData.length === 0" class="text-center text-gray-500 mt-8">
            No net worth data available yet.
        </div>
    </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{end}}